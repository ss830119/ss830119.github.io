"use strict";Vue.component("lottery-backfill",{template:"#lotteryBackfill",data:function(){return{type:"",mobile:"",userid:"",awardPaper:[{awardName:"現金 NT.99,999",path:"images/《能量不斷電終極大獎 現金99,999》中獎回覆函.doc"},{awardName:"Nintendo Switch",path:"images/《補充能量獎週週抽 Nintendo Switch》中獎回覆函.doc"},{awardName:"SONY PS4",path:"images/《百大鐵人排名獎 SONY PS4》中獎回覆函.doc"}],paper:null,fblogin:!1,fbData:{fbToken:"",fbId:"",fbName:"",fbPic:""},invNumber:"",awardItem:"",name:"",address:"",IdcardFront:null,IdcardBack:null,Bankbook:null,CertificatePhoto:null,agree:!1,imageShow:{IdcardFront:null,IdcardBack:null,Bankbook:null,CertificatePhoto:null}}},watch:{IdcardFront:function(){""==!this.IdcardFrontShow&&($("#frontpre p").css("display","none"),$("#frontpre img").css("opacity","1"))},IdcardBack:function(){""==!this.IdcardBackShow&&($("#backpre p").css("display","none"),$("#backpre img").css("opacity","1"))},Bankbook:function(){""==!this.BankbookShow&&($("#bankpre p").css("display","none"),$("#bankpre img").css("opacity","1"))},CertificatePhotoShow:function(){""==!this.CertificatePhotoShow&&($("#certificatepre p").css("display","none"),$("#certificatepre img").css("opacity","1"))}},methods:{readpoto:function(e){var a=this,t=e.target.files.item(0),n=e.target.id,e=new FileReader;e.addEventListener("load",function(e){"front"==n&&(a.imageShow.IdcardFront=e.target.result,a.IdcardFront=t);"back"==n&&(a.imageShow.IdcardBack=e.target.result,a.IdcardBack=t);"bank"==n&&(a.imageShow.Bankbook=e.target.result,a.Bankbook=t);"certificate"==n&&(a.imageShow.CertificatePhoto=e.target.result,a.CertificatePhoto=t)}),e.readAsDataURL(t)},postback:function(){var a=this;if(!a.loading){if(a.loading=!0,!a.name)return alert("請填入收件人"),void(a.loading=!1);if(!a.address)return alert("請填入地址"),void(a.loading=!1);if("FB"==a.type){if(!a.fbData.fbId)return alert("請先登入FB"),void(a.loading=!1)}else if("Invoice"==a.type&&!a.CertificatePhoto)return alert("請上傳發票正本電子檔"),void(a.loading=!1);if(!a.agree)return alert("請勾選我已詳閱"),void(a.loading=!1);a.getToken().then(function(){a.grecaptcha("backfill").then(function(){a.postRecipientinfo().then(function(e){e.success?alert("資料已送出，感謝您的參與！"):alert("您並無資格領取此獎項。"),window.location.href="./index.html",a.loading=!1})})})}},fbLogin:function(){var a=this;FB.login(function(e){"connected"===e.status&&(a.fbData.fbToken=e.authResponse.accessToken,a.fbData.fbId=e.authResponse.userID,FB.api("/me","GET",{fields:"id,name,picture"},function(e){a.fbData.fbName=e.name,a.fbData.fbPic="http://graph.facebook.com/"+e.id+"/picture?width=140&height=140",a.fblogin=!0}))})},getRecipientinfo:function(){var a=this;return $.ajax({url:"".concat(friendo_url,"comebest/recipientinfo/").concat(a.userid),headers:{Authorization:"Bearer "+a.mainToken},method:"GET"}).done(function(e){e.success?(a.mobile=e.data.mobile,a.invNumber=e.data.referenceInfo,a.awardItem=e.data.awardName,a.type=e.data.referenceType):(alert("資料已回填或無法查獲此獎項"),window.location.href="./index.html")})},checkPaper:function(){var a=this;a.awardPaper.forEach(function(e){if(a.awardItem==e.awardName)return a.paper=e})}},mounted:function(){var e=this;$("body").loadpage("init",{async:!1}),e.userid=findGetParameter("user"),e.getToken().then(function(){e.getRecipientinfo().then(function(){e.checkPaper()})})}});